@startuml Diagramme de classes logiciel - Projet GL

' =============================
' === PARAMÈTRES GLOBAUX ===
' =============================
skinparam ranksep 120
skinparam nodesep 100
skinparam linetype ortho
left to right direction

' =============================
' === MODELE (Model) ===
' =============================
package "Model" #DDFFDD {

  enum Univers

  class Personnage {
    -String nom
    -String profession
    -String naissanceDate
    -String image
    -Univers univers
    -Biographie biographie
    +void setProfession(String newProfession)
    +void supprimer()
  }
  class Joueur {
    -String nom
    +Personnage creerPersonnage(String nom, String naissanceDate, String profession, Biographie bioInitiale)
    +Partie proposerPartie(String titre, Univers univers, String resume)
    +void accepterPartie(Partie p)
    +void accepterPersonnage(Personnage personnage)
    +void validerEpisode(Episode e)
  }
  class Partie {
    -boolean dejaJouee
    -boolean validee
    -List<Personnage> personnages
    +void valider()
    +void ajouterPersonnage(Personnage p)
    +void supprimerPersonnage(Personnage p)
    +void jouer()
  }
  class Aventure{

  }
  class Biographie {
    -String titre
    -List<Episode> episodes
    +void ajouterEpisode(Episode e)
  }
  class Episode {
    -String titre
    -List<Paragraphe> paragraphes
    +void ajouterParagraphe(Paragraphe p)
    +void valider()
  }
  class Paragraphe {
    -String titre
    -boolean isPrivate
    +void rendrePublique()
  }
  abstract class Sujet {
    +attache(Observateur o)
    +detache(Observateur o)
    +informe()
  }
  interface Observateur {
    +miseAJour()
  }

  Sujet <|-- Partie
  Sujet <|-- Episode
  Sujet <|-- Paragraphe
  Sujet <|-- Joueur
}

' =============================
' === VUE (View) ===
' =============================
package "View" #DDEEFF {
  package "joueur" {
    class VueConnexion {
    }

    class VueJoueur {
    }

    class VueAccueil{
    }
  }
  package "biographie" {
    class VueBiographie {
    }

    class VueAjouterParagraphe {

    }

    class VueModifierParagraphe {

    }
  }
  package "partie" {
    class VuePartie {
    }

    class VueAjouterPartie {

    }

    class VueModifierPartie {

    }
  }
  package "personnage" {
    class VuePersonnage {
    }
    
    class VueAjouterPersonnage {

    }

    class VueModifierPersonnage {

    }
  }

  interface Vue {
    +afficher()
  }

  class VueConfirmation {

  }

  Vue <|.. VueConfirmation
  Vue <|.. VueConnexion
  Vue <|.. VueJoueur
  Vue <|.. VueAccueil
  Vue <|.. VueBiographie
  Vue <|.. VueAjouterParagraphe 
  Vue <|.. VueModifierParagraphe
  Vue <|.. VuePartie
  Vue <|.. VueAjouterPartie
  Vue <|.. VueModifierPartie
  Vue <|.. VuePersonnage
  Vue <|.. VueAjouterPersonnage
  Vue <|.. VueModifierPersonnage
}

' Implémentation du partern observateur

Observateur <|.. VuePartie
Observateur <|.. VueEpisode
Observateur <|.. VueParagraphe
Observateur <|.. VueJoueur

' =============================
' === CONTROLEUR (Controller) ===
' =============================
package "Controller" #FFE4B5 {
  package "joueur" {
    class ControleurConnexion {
    }

    class ControleurJoueur {
      +Joueur creerJoueur()
      +void modifierJoueur(
    }

    class ControleurAccueil{
    }
  }
  package "biographie" {
    class ControleurBiographie {
      +Biographie creerBiographie()
      +void modifierBiographie()
    }

    class ControleurAjouterParagraphe {

    }

    class ControleurModifierParagraphe {

    }
  }
  package "partie" {
    class ControleurPartie {
      +Partie creerPartie()
      +void modifierPartie()
    }

    class ControleurAjouterPartie {

    }

    class ControleurModifierPartie {

    }
  }
  package "personnage" {
    class ControleurPersonnage {
    }
    
    class ControleurAjouterPersonnage {
      +Personnage creerPersonnage()
      +void modifierPersonnage()
    }

    class ControleurModifierPersonnage {

    }
  }

  enum Commande {
    FERMER,
    QUITTER,
    RETOUR,
    ACCEPTER,
    REFUSER,
  }

  abstract class Controleur {
    ~ abstract void handleLocalInput(String input);
    + void processInput()
    + void handleGlobalCommand(Commande cmd)
  }

  class ControleurConfirmation {

  }

  Controleur <|-- ControleurConfirmation
  Controleur <|-- ControleurConnexion
  Controleur <|-- ControleurJoueur
  Controleur <|-- ControleurAccueil
  Controleur <|-- ControleurBiographie
  Controleur <|-- ControleurAjouterParagraphe 
  Controleur <|-- ControleurModifierParagraphe
  Controleur <|-- ControleurPartie
  Controleur <|-- ControleurAjouterPartie
  Controleur <|-- ControleurModifierPartie
  Controleur <|-- ControleurPersonnage
  Controleur <|-- ControleurAjouterPersonnage
  Controleur <|-- ControleurModifierPersonnage

  Controleur .. Commande
  ControleurConfirmation .. Commande
}
' === Relations MVC ===
ControleurPartie --> Partie
ControleurJoueur --> Joueur
ControleurPersonnage --> Personnage
ControleurBiographie --> Biographie

VuePartie ..|> Vue
VueJoueur ..|> Vue
VuePersonnage ..|> Vue
VueBiographie ..|> Vue
VueParagraphe ..|> Vue
VueEpisode ..|> Vue
VueConnexion ..|> Vue
VueAccueil ..|> Vue

VuePartie --> ControleurPartie
VueJoueur --> ControleurJoueur
VuePersonnage --> ControleurPersonnage
VueBiographie --> ControleurBiographie
VueParagraphe --> ControleurBiographie
VueEpisode --> ControleurBiographie
VueConnexion --> ControleurJoueur
VueAccueil --> ControleurJoueur

VuePartie .[#blue].> Partie : observe >
VueEpisode .[#blue].> Episode : observe >
VueParagraphe .[#blue].> Paragraphe : observe >
VueJoueur .[#blue].> Joueur : observe >

' =============================
' === PERSISTENCE (SQLite) ===
' =============================
package "Persistence" #FFF2CC {

  class SQLiteManager {
    -Connection connection
    +Connection getConnection()
    +void closeConnection()
  }

  interface DAO<T> {
    +void save(T entity)
    +T findById(int id)
    +List<T> findAll()
    +void update(T entity)
    +void delete(int id)
  }

  class PersonnageDAO {
    +void save(Personnage p)
    +Personnage findById(int id)
    +List<Personnage> findAll()
    +void update(Personnage p)
    +void delete(int id)
  }

  class JoueurDAO {
    +void save(Joueur j)
    +Joueur findById(int id)
    +Joueur findByName(String name)
    +List<Joueur> findAll()
  }

  class PartieDAO {
    +void save(Partie p)
    +List<Partie> findAll()
    +Partie findById(int id)
  }
  
  class ParagrapheDAO {
    +void save(Paragraphe p)
    +List<Paragraphe> findAll()
    +Paragraphe findById(int id)
  }

  DAO <|.. PersonnageDAO
  DAO <|.. JoueurDAO
  DAO <|.. PartieDAO
  DAO <|.. ParagrapheDAO

  SQLiteManager --> DAO : fournit connexion >

  PersonnageDAO --> SQLiteManager
  JoueurDAO --> SQLiteManager
  PartieDAO --> SQLiteManager
  ParagrapheDAO --> SQLiteManager

  PersonnageDAO <-- ControleurPersonnage : gère la persistance >
  JoueurDAO <-- ControleurJoueur : gère la persistance >
  PersonnageDAO <-- ControleurJoueur
  PartieDAO <-- ControleurJoueur
  ParagrapheDAO <-- ControleurJoueur
  PartieDAO <-- ControleurPartie : gère la persistance >
  ParagrapheDAO <-- ControleurParagraphe : gère la persistance >
}

' Alignement vertical (vue du haut vers le bas)
' Model -[hidden]down-> Controller
' Controller -[hidden]down-> Persistence

@enduml
